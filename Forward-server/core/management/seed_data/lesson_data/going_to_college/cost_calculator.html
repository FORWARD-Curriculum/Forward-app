<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>College Cost Calculator</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --card-2: #0b1220;
        --muted: #9aa4b2;
        --text: #e5e7eb;
        --accent: #68b5ff;
        --accent-2: #8b5cf6;
        --good: #22c55e;
        --warn: #f59e0b;
        --danger: #ef4444;
        --outline: #1f2937;
        --chip: #1f2a44;
        --chip-text: #c7d2fe;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 12px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        background: radial-gradient(1200px 600px at 70% -100px, #1d2a47, #0b1220)
            no-repeat,
          var(--bg);
        color: var(--text);
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI,
          Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }

      .app {
        max-width: 1100px;
        margin: 24px auto 64px;
        padding: 0 16px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 16px;
      }

      .title {
        font-size: 24px;
        font-weight: 700;
        letter-spacing: 0.2px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .badge {
        font-size: 12px;
        color: #d1fae5;
        background: linear-gradient(135deg, #064e3b, #065f46);
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid #10b98133;
      }

      .view-toggle {
        background: linear-gradient(180deg, #101827, #0e1626);
        border: 1px solid var(--outline);
        border-radius: 999px;
        display: inline-flex;
        padding: 4px;
        gap: 6px;
        box-shadow: var(--shadow);
      }
      .view-toggle button {
        background: transparent;
        border: none;
        color: var(--muted);
        padding: 8px 14px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.15s ease;
      }
      .view-toggle button.active {
        color: #0b1220;
        background: linear-gradient(180deg, #68b5ff, #77d1ff);
      }

      .layout {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 16px;
      }
      @media (max-width: 980px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        background: linear-gradient(180deg, #0e1626, #0c1423);
        border: 1px solid var(--outline);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }

      .categories {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        padding: 16px;
      }
      @media (max-width: 720px) {
        .categories {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: linear-gradient(180deg, #0f192c, #0d1730);
        border: 1px solid #1d2741;
        border-radius: 14px;
        padding: 14px;
        position: relative;
        overflow: hidden;
      }

      .card h3 {
        margin: 0 0 8px;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .sub {
        color: var(--muted);
        font-size: 12px;
        margin-bottom: 8px;
      }

      .options {
        display: grid;
        gap: 8px;
        margin-bottom: 10px;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        gap: 8px;
      }

      .seg {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .chip {
        border: 1px solid #2b3b66;
        background: var(--chip);
        color: var(--chip-text);
        border-radius: 10px;
        padding: 6px 10px;
        cursor: pointer;
        font-weight: 600;
        font-size: 12px;
        transition: 0.15s ease;
        user-select: none;
      }
      .chip[aria-pressed="true"] {
        background: linear-gradient(180deg, #7aa5ff, #8bb6ff);
        color: #0b1220;
        border-color: #a9c8ff;
        box-shadow: 0 0 0 3px #7aa5ff33 inset;
      }

      .slider-row {
        display: grid;
        grid-template-columns: 1fr max-content;
        gap: 10px;
        align-items: center;
      }
      input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        appearance: none;
        background: transparent;
        height: 24px;
      }
      input[type="range"]::-webkit-slider-runnable-track {
        height: 8px;
        background: linear-gradient(90deg, #28406c, #2c4f87);
        border-radius: 999px;
      }
      input[type="range"]::-moz-range-track {
        height: 8px;
        background: linear-gradient(90deg, #28406c, #2c4f87);
        border-radius: 999px;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ffffff, #d7e6ff);
        border: 2px solid #69b6ff;
        margin-top: -5px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        cursor: pointer;
      }
      input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ffffff, #d7e6ff);
        border: 2px solid #69b6ff;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        cursor: pointer;
      }

      .money {
        font-variant-numeric: tabular-nums;
        font-weight: 700;
        color: #c7e2ff;
        background: #102240;
        border: 1px solid #25406f;
        padding: 4px 8px;
        border-radius: 8px;
      }

      .tooltip {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: var(--muted);
        font-size: 12px;
        cursor: help;
      }
      .tooltip .bubble {
        position: absolute;
        left: 0;
        bottom: calc(100% + 8px);
        background: #0b1324;
        border: 1px solid #2a3b66;
        border-radius: 10px;
        color: #dbeafe;
        padding: 8px 10px;
        width: max-content;
        max-width: 280px;
        box-shadow: var(--shadow);
        opacity: 0;
        transform: translateY(4px);
        pointer-events: none;
        transition: 0.15s ease;
        z-index: 5;
      }
      .tooltip:hover .bubble {
        opacity: 1;
        transform: translateY(0px);
      }

      .summary {
        padding: 16px;
        position: sticky;
        top: 12px;
      }
      .summary h2 {
        margin: 0 0 10px;
        font-size: 18px;
      }
      .line {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-variant-numeric: tabular-nums;
        padding: 8px 0;
        border-bottom: 1px dashed #263453;
        color: #cbd5e1;
      }
      .line:last-child {
        border-bottom: none;
      }
      .line .label {
        color: #9fb3d1;
      }
      .grand {
        font-size: 22px;
        font-weight: 800;
        color: #e2f0ff;
      }
      .note {
        font-size: 12px;
        color: var(--muted);
        margin-top: 8px;
      }

      .footer {
        margin-top: 16px;
        padding: 12px 16px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        border-top: 1px solid var(--outline);
        background: linear-gradient(180deg, #0d1423, #0b1220);
        border-bottom-left-radius: var(--radius);
        border-bottom-right-radius: var(--radius);
      }

      .btn {
        border: 1px solid #27416e;
        background: linear-gradient(180deg, #1a2d50, #0f2143);
        color: #dbeafe;
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        transition: 0.15s ease;
      }
      .btn:hover {
        filter: brightness(1.1);
      }
      .btn.primary {
        background: linear-gradient(180deg, #5ca7ff, #4f82ff);
        border-color: #7fb9ff;
        color: #0b1220;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid #284577;
        background: #0e1b34;
        color: #cae1ff;
      }

      .group {
        display: grid;
        gap: 8px;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="header">
        <div class="title">
          ðŸŽ“ College Cost Calculator
          <span class="badge">Interactive</span>
        </div>
        <div class="view-toggle" role="tablist" aria-label="View scale">
          <button class="active" data-scale="semester" role="tab" aria-selected="true">
            Per Semester
          </button>
          <button data-scale="year" role="tab" aria-selected="false">
            Per Academic Year
          </button>
          <button data-scale="four" role="tab" aria-selected="false">
            4-Year Degree
          </button>
        </div>
      </div>

      <div class="layout">
        <div class="panel">
          <div class="categories">
            <!-- Tuition and Fees -->
            <div class="card" data-category="tuition">
              <h3>Tuition & Fees</h3>
              <div class="sub">
                Choose school type and residency, then adjust expected tuition.
              </div>
              <div class="group">
                <div class="seg" role="group" aria-label="Institution type">
                  <div
                    class="chip"
                    role="button"
                    tabindex="0"
                    data-name="schoolType"
                    data-value="public"
                    aria-pressed="true"
                  >
                    Public
                  </div>
                  <div
                    class="chip"
                    role="button"
                    tabindex="0"
                    data-name="schoolType"
                    data-value="private"
                    aria-pressed="false"
                  >
                    Private
                  </div>
                </div>
                <div class="seg" role="group" aria-label="Residency">
                  <div
                    class="chip"
                    role="button"
                    tabindex="0"
                    data-name="residency"
                    data-value="in"
                    aria-pressed="true"
                  >
                    In-State
                  </div>
                  <div
                    class="chip"
                    role="button"
                    tabindex="0"
                    data-name="residency"
                    data-value="out"
                    aria-pressed="false"
                  >
                    Out-of-State
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >Public In-State (annual): $5,000â€“$15,000<br />Public
                    Out-of-State (annual): $15,000â€“$35,000<br />Private
                    (annual): $25,000â€“$60,000</span
                  >
                </div>
                <span class="pill">Tuition + required fees</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="2500"
                  max="60000"
                  step="100"
                  value="8000"
                  data-name="tuitionAnnual"
                  aria-label="Annual tuition and fees"
                />
                <div class="money" id="tuitionDisplay">$8,000 / yr</div>
              </div>
            </div>

            <!-- Room and Board -->
            <div class="card" data-category="housing">
              <h3>Room & Board</h3>
              <div class="sub">Select living arrangement and adjust cost.</div>
              <div class="seg" role="group" aria-label="Housing option">
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="housing"
                  data-value="dorm"
                  aria-pressed="true"
                >
                  On-campus dorm
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="housing"
                  data-value="off"
                  aria-pressed="false"
                >
                  Off-campus
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="housing"
                  data-value="home"
                  aria-pressed="false"
                >
                  Live at home
                </div>
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >On-campus (annual): $9,000â€“$16,000<br />Off-campus
                    (annual): $8,000â€“$18,000<br />Living at home: $0â€“$6,000
                    (contributions)</span
                  >
                </div>
                <span class="pill">Housing + utilities</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="0"
                  max="20000"
                  step="100"
                  value="12000"
                  data-name="housingAnnual"
                  aria-label="Annual room and board"
                />
                <div class="money" id="housingDisplay">$12,000 / yr</div>
              </div>
            </div>

            <!-- Meals -->
            <div class="card" data-category="meals">
              <h3>Meals</h3>
              <div class="sub">Choose meal approach and adjust cost.</div>
              <div class="seg" role="group" aria-label="Meal plan">
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="meals"
                  data-value="self"
                  aria-pressed="true"
                >
                  Self-cooking
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="meals"
                  data-value="plan"
                  aria-pressed="false"
                >
                  Campus meal plan
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="meals"
                  data-value="mix"
                  aria-pressed="false"
                >
                  Mix
                </div>
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >Self-cook (annual): $2,000â€“$3,500<br />Meal plan (annual):
                    $3,500â€“$6,500<br />Mix (annual): $2,800â€“$5,000</span
                  >
                </div>
                <span class="pill">Groceries or dining plan</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="1000"
                  max="7000"
                  step="50"
                  value="2800"
                  data-name="mealsAnnual"
                  aria-label="Annual meal costs"
                />
                <div class="money" id="mealsDisplay">$2,800 / yr</div>
              </div>
            </div>

            <!-- Books & Supplies -->
            <div class="card" data-category="books">
              <h3>Books & Supplies</h3>
              <div class="sub">Choose material type and adjust cost.</div>
              <div class="seg" role="group" aria-label="Materials">
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="books"
                  data-value="new"
                  aria-pressed="false"
                >
                  New
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="books"
                  data-value="used"
                  aria-pressed="true"
                >
                  Used
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="books"
                  data-value="rent"
                  aria-pressed="false"
                >
                  Rented
                </div>
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >New (annual): $800â€“$1,500<br />Used (annual):
                    $500â€“$900<br />Rented (annual): $300â€“$700</span
                  >
                </div>
                <span class="pill">Texts + lab supplies</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="200"
                  max="2000"
                  step="25"
                  value="700"
                  data-name="booksAnnual"
                  aria-label="Annual books and supplies"
                />
                <div class="money" id="booksDisplay">$700 / yr</div>
              </div>
            </div>

            <!-- Health Insurance -->
            <div class="card" data-category="health">
              <h3>Health Insurance</h3>
              <div class="sub">Choose provider type and adjust cost.</div>
              <div class="seg" role="group" aria-label="Insurance">
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="health"
                  data-value="private"
                  aria-pressed="true"
                >
                  Private
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="health"
                  data-value="university"
                  aria-pressed="false"
                >
                  University plan
                </div>
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >Private (annual): $1,000â€“$3,000<br />University plan
                    (annual): $1,800â€“$4,000</span
                  >
                </div>
                <span class="pill">Premiums and mandatory fees</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="0"
                  max="5000"
                  step="50"
                  value="1800"
                  data-name="healthAnnual"
                  aria-label="Annual health insurance"
                />
                <div class="money" id="healthDisplay">$1,800 / yr</div>
              </div>
            </div>

            <!-- Transportation -->
            <div class="card" data-category="transport">
              <h3>Transportation</h3>
              <div class="sub">
                Commutes + trips home during breaks. Choose typical mode.
              </div>
              <div class="seg" role="group" aria-label="Transportation mode">
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="transport"
                  data-value="car"
                  aria-pressed="true"
                >
                  Car
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="transport"
                  data-value="bus"
                  aria-pressed="false"
                >
                  Bus/Train
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="transport"
                  data-value="rideshare"
                  aria-pressed="false"
                >
                  Rideshare
                </div>
                <div
                  class="chip"
                  role="button"
                  tabindex="0"
                  data-name="transport"
                  data-value="plane"
                  aria-pressed="false"
                >
                  Plane
                </div>
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >Car (annual): $1,500â€“$4,000 (fuel, insurance, parking)<br />Bus/Train
                    (annual): $300â€“$1,200<br />Rideshare (annual): $700â€“$2,500<br />Plane
                    trips (annual): $400â€“$2,000</span
                  >
                </div>
                <span class="pill">Commuting + breaks</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="0"
                  max="6000"
                  step="50"
                  value="1500"
                  data-name="transportAnnual"
                  aria-label="Annual transportation"
                />
                <div class="money" id="transportDisplay">$1,500 / yr</div>
              </div>
            </div>

            <!-- Personal -->
            <div class="card" data-category="personal">
              <h3>Personal Expenses</h3>
              <div class="sub">
                Toiletries, laundry, phone, entertainment, etc.
              </div>

              <div class="row">
                <div class="tooltip">
                  Typical ranges
                  <span class="bubble"
                    >Personal (annual): $1,000â€“$3,000 (varies by location and
                    lifestyle)</span
                  >
                </div>
                <span class="pill">Miscellaneous</span>
              </div>

              <div class="slider-row">
                <input
                  type="range"
                  min="0"
                  max="5000"
                  step="50"
                  value="1500"
                  data-name="personalAnnual"
                  aria-label="Annual personal expenses"
                />
                <div class="money" id="personalDisplay">$1,500 / yr</div>
              </div>
            </div>
          </div>

          <div class="footer">
            <button class="btn" id="resetBtn">Reset</button>
            <button class="btn primary" id="finishBtn">
              Finish & Mark Complete
            </button>
          </div>
        </div>

        <aside class="panel summary" aria-live="polite">
          <h2>Summary</h2>
          <div class="line">
            <span class="label">Tuition & Fees</span>
            <span id="sumTuition">$0</span>
          </div>
          <div class="line">
            <span class="label">Room & Board</span>
            <span id="sumHousing">$0</span>
          </div>
          <div class="line">
            <span class="label">Meals</span>
            <span id="sumMeals">$0</span>
          </div>
          <div class="line">
            <span class="label">Books & Supplies</span>
            <span id="sumBooks">$0</span>
          </div>
          <div class="line">
            <span class="label">Health Insurance</span>
            <span id="sumHealth">$0</span>
          </div>
          <div class="line">
            <span class="label">Transportation</span>
            <span id="sumTransport">$0</span>
          </div>
          <div class="line">
            <span class="label">Personal</span>
            <span id="sumPersonal">$0</span>
          </div>

          <div class="line" style="margin-top: 6px">
            <span class="label">Total (per selected view)</span>
            <span class="grand" id="grandTotal">$0</span>
          </div>
          <div class="note" id="scaleNote">Showing per semester estimates.</div>
        </aside>
      </div>
    </div>

    <script>
      // State
      const state = {
        scale: "semester", // semester | year | four
        schoolType: "public",
        residency: "in",
        tuitionAnnual: 8000,
        housing: "dorm",
        housingAnnual: 12000,
        meals: "self",
        mealsAnnual: 2800,
        books: "used",
        booksAnnual: 700,
        health: "private",
        healthAnnual: 1800,
        transport: "car",
        transportAnnual: 1500,
        personalAnnual: 1500,
      };

      const currency = (n) =>
        n.toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 0 });

      // DOM refs
      const q = (sel, el = document) => el.querySelector(sel);
      const qa = (sel, el = document) => Array.from(el.querySelectorAll(sel));

      const displays = {
        tuition: q("#tuitionDisplay"),
        housing: q("#housingDisplay"),
        meals: q("#mealsDisplay"),
        books: q("#booksDisplay"),
        health: q("#healthDisplay"),
        transport: q("#transportDisplay"),
        personal: q("#personalDisplay"),
      };

      const sums = {
        tuition: q("#sumTuition"),
        housing: q("#sumHousing"),
        meals: q("#sumMeals"),
        books: q("#sumBooks"),
        health: q("#sumHealth"),
        transport: q("#sumTransport"),
        personal: q("#sumPersonal"),
        grand: q("#grandTotal"),
        note: q("#scaleNote"),
      };

      // Scale conversion helpers
      function toScale(annualValue, scale) {
        switch (scale) {
          case "semester":
            // assume two semesters per academic year
            return annualValue / 2;
          case "year":
            return annualValue;
          case "four":
            return annualValue * 4;
          default:
            return annualValue;
        }
      }

      // Map chips to recommended slider defaults (for user guidance)
      const recommend = {
        tuitionAnnual({ schoolType, residency }) {
          if (schoolType === "private") return 38000;
          if (schoolType === "public" && residency === "out") return 26000;
          return 10000; // public in-state
        },
        housingAnnual({ housing }) {
          if (housing === "dorm") return 13000;
          if (housing === "off") return 14000;
          if (housing === "home") return 3000;
          return 12000;
        },
        mealsAnnual({ meals }) {
          if (meals === "plan") return 5200;
          if (meals === "mix") return 3800;
          return 2800; // self
        },
        booksAnnual({ books }) {
          if (books === "new") return 1100;
          if (books === "rent") return 500;
          return 700; // used
        },
        healthAnnual({ health }) {
          if (health === "university") return 2400;
          return 1800; // private
        },
        transportAnnual({ transport }) {
          if (transport === "bus") return 600;
          if (transport === "rideshare") return 1200;
          if (transport === "plane") return 1200;
          return 1800; // car total annualized
        },
        personalAnnual() {
          return 1500;
        },
      };

      function updateDisplays() {
        // annual labels on sliders
        displays.tuition.textContent = currency(state.tuitionAnnual) + " / yr";
        displays.housing.textContent = currency(state.housingAnnual) + " / yr";
        displays.meals.textContent = currency(state.mealsAnnual) + " / yr";
        displays.books.textContent = currency(state.booksAnnual) + " / yr";
        displays.health.textContent = currency(state.healthAnnual) + " / yr";
        displays.transport.textContent = currency(state.transportAnnual) + " / yr";
      }

      function computeTotals() {
        const categories = [
          state.tuitionAnnual,
          state.housingAnnual,
          state.mealsAnnual,
          state.booksAnnual,
          state.healthAnnual,
          state.transportAnnual,
          state.personalAnnual,
        ];
        const labels = [
          "tuition",
          "housing",
          "meals",
          "books",
          "health",
          "transport",
          "personal",
        ];

        let grand = 0;
        for (let i = 0; i < categories.length; i++) {
          const scaled = toScale(categories[i], state.scale);
          grand += scaled;
          sums[labels[i]].textContent = currency(scaled);
        }
        sums.grand.textContent = currency(grand);

        switch (state.scale) {
          case "semester":
            sums.note.textContent = "Showing per semester estimates.";
            break;
          case "year":
            sums.note.textContent = "Showing per academic year estimates.";
            break;
          case "four":
            sums.note.textContent = "Showing total estimated cost for a 4â€‘year degree.";
            break;
        }
      }

      function setChip(groupName, value) {
        qa(`.chip[data-name="${groupName}"]`).forEach((el) => {
          const pressed = el.getAttribute("data-value") === value ? "true" : "false";
          el.setAttribute("aria-pressed", pressed);
        });
      }

      function applyRecommendationFor(group) {
        // Update corresponding annual slider when a categorical choice changes
        let key = null;
        switch (group) {
          case "schoolType":
          case "residency":
            key = "tuitionAnnual";
            break;
          case "housing":
            key = "housingAnnual";
            break;
          case "meals":
            key = "mealsAnnual";
            break;
          case "books":
            key = "booksAnnual";
            break;
          case "health":
            key = "healthAnnual";
            break;
          case "transport":
            key = "transportAnnual";
            break;
        }
        if (!key) return;
        const v = recommend[key](state);
        state[key] = clampToSlider(key, v);
        // push value into the actual input
        const input = q(`input[data-name="${key}"]`);
        if (input) input.value = String(state[key]);
        updateDisplays();
        computeTotals();
      }

      function clampToSlider(key, value) {
        const input = q(`input[data-name="${key}"]`);
        if (!input) return value;
        const min = Number(input.min);
        const max = Number(input.max);
        return Math.min(max, Math.max(min, value));
      }

      // Event wiring
      function bindChips() {
        qa(".chip").forEach((chip) => {
          chip.addEventListener("click", () => {
            const group = chip.getAttribute("data-name");
            const value = chip.getAttribute("data-value");
            state[group] = value;
            setChip(group, value);
            applyRecommendationFor(group);
          });
          chip.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              chip.click();
            }
          });
        });
      }

      function bindSliders() {
        qa('input[type="range"]').forEach((slider) => {
          slider.addEventListener("input", () => {
            const name = slider.getAttribute("data-name");
            const val = Number(slider.value);
            state[name] = val;
            updateDisplays();
            computeTotals();
          });
        });
      }

      function bindScaleToggle() {
        qa(".view-toggle button").forEach((btn) => {
          btn.addEventListener("click", () => {
            const scale = btn.getAttribute("data-scale");
            state.scale = scale;
            qa(".view-toggle button").forEach((b) => {
              const active = b.getAttribute("data-scale") === scale;
              b.classList.toggle("active", active);
              b.setAttribute("aria-selected", active ? "true" : "false");
            });
            computeTotals();
          });
        });
      }

      function bindFooter() {
        q("#resetBtn").addEventListener("click", () => {
          // Reset state to defaults and UI to match
          Object.assign(state, {
            scale: "semester",
            schoolType: "public",
            residency: "in",
            tuitionAnnual: 8000,
            housing: "dorm",
            housingAnnual: 12000,
            meals: "self",
            mealsAnnual: 2800,
            books: "used",
            booksAnnual: 700,
            health: "private",
            healthAnnual: 1800,
            transport: "car",
            transportAnnual: 1500,
            personalAnnual: 1500,
          });
          // Reset chips
          setChip("schoolType", "public");
          setChip("residency", "in");
          setChip("housing", "dorm");
          setChip("meals", "self");
          setChip("books", "used");
          setChip("health", "private");
          setChip("transport", "car");
          // Reset sliders
          qa('input[type="range"]').forEach((slider) => {
            const name = slider.getAttribute("data-name");
            slider.value = String(state[name]);
          });
          // Reset scale buttons
          qa(".view-toggle button").forEach((b) => {
            const active = b.getAttribute("data-scale") === "semester";
            b.classList.toggle("active", active);
            b.setAttribute("aria-selected", active ? "true" : "false");
          });
          updateDisplays();
          computeTotals();
        });

        q("#finishBtn").addEventListener("click", () => {
          // Define completion state: user has interacted with at least one control,
          // or they choose to mark as complete. We simply post the message.
          try {
            window.parent.postMessage({ type: "activityEnd" }, "*");
          } catch (e) {
            // no-op
          }
          // Provide brief visual feedback
          const btn = q("#finishBtn");
          const prev = btn.textContent;
          btn.textContent = "Completed âœ“";
          btn.disabled = true;
          setTimeout(() => {
            btn.textContent = prev;
            btn.disabled = false;
          }, 1500);
        });
      }

      // Initialize
      bindChips();
      bindSliders();
      bindScaleToggle();
      bindFooter();
      updateDisplays();
      computeTotals();

      // Accessibility: announce changes on scale change already handled via aria-live
    </script>
  </body>
</html>