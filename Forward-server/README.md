# API Documentation

[Back to Main Docs](../README.md)

[Database Docs](./database-diagram.md)

## Introduction

#### All responses follow a consistent format

```json
{
  "detail": "Some message",
  "data": {
    "exampleObject": {
      "exampleField1": "content",
      "exampleField2": "more content"
    }
  }
}
```

#### For **Unauthorized** requests (no valid session/credentials):

- Status Code: 401 UNAUTHORIZED
- Default Response Body:

```json
{
  "detail": "Authentication credentials were not provided."
}
```

#### For **Unauthorized** reqeusts (authenticated but forbidden):

- Status Code: 403 FORBIDDEN
- Default Response Body:

```json
{
  "detail": "You do not have permission to perform this action."
}
```

# Endpoints

User Endpoints

- [/api/session](#apisession)
- [/api/users](#apiusers)
- [/api/users/me](#apiusersme)

Curriculum Endpoints

- Quiz - [/api/quiz/:id](#apiquizid)
- Quiz Submission - [/api/test/:id](#apitestid)
- Text Content - [/api/readings/:lessonId](#apireadingslessonid)
- Lesson - [/api/lessons/:id](#apilessonsid)
- Video Content - [/api/video-content/:lessonId](#apivideo-contentlessonid)
- Media Asset - [/api/media-asset/:videoContentId](#apimedia-assetvideocontentid)
- Poll - [/api/poll/:id](#apipollid)
- Poll Question - [/api/poll-question/:pollId](#apipoll-questionpollid)
- Writing Activity - [/api/writing-activity/:lessonId](#apiwriting-activitylessonid)

## User Endpoints

### /api/session

<details>
<summary>POST - Log In a User</summary>
Logs in a current user with valid credentials and returns the current user's
information.

- Require Authentication: false
- Request

  - Method `POST`
  - URL: /api/session
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "credential": "js01ca28",
      "password": "secret password"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": "successfully logged in the user",
      "data": {
        "user": {
          "id": 1,
          "username": "js01ca28",
          "display_name": "John Smith",
          "facility_id": "94805897432092394720",
          "profile_picture": "cdn://user/1?height=100&width=100",
          "consent": false
        }
      }
    }
    ```

- Error Response: Invalid credentials

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Invalid credentials"
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
          "errors": {
            "credential": "Email or username is required",
            "password": "Password is required"
          }
        }
        ```

    </details>

<details>
<summary>DELETE - Log Out a User</summary>
Returns the information about the current user that is logged in.

- Require Authentication: true
- Request

  - Method: DELETE
  - URL: /api/session
  - Body: none

- Successful Response when there is a logged in user

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "detail":"Logout successful",
          "data": {}
        }
        ```

    </details>

### /api/users

<details>
<summary>POST - Sign Up a User</summary>
Creates a new user, logs them in as the current user, and returns the current
user's information.

- Require Authentication: false
- Request

  - Method `POST`
  - URL: /api/users
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "firstName": "John",
      "lastName": "Smith",
      "email": "john.smith@gmail.com",
      "username": "JohnSmith",
      "password": "secret password",
      "passwordConfirm": "secret password"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": "successful user creation completed",
      "data": {
        "user": {
          "id": 1,
          "firstName": "John",
          "lastName": "Smith",
          "email": "john.smith@gmail.com",
          "username": "JohnSmith"
        }
      }
    }
    ```

- Error response: User already exists with the specified email

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "email": "User with that email already exists"
      }
    }
    ```

- Error response: User already exists with the specified username

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "username": "User with that username already exists"
      }
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
      "errors": {
        "email": "Invalid email",
        "username": "Username is required",
        "firstName": "First Name is required",
        "lastName": "Last Name is required"
      }
    }
    ```

    </details>

### /api/users/me

<details>
<summary>GET - Retrieve the current user</summary>
Confirms the current user is logged in, and returns user info.

- Require Authentication: true
- Request

  - Method `GET`
  - URL: /api/users/me
  - Headers:
    - Content-Type: application/json
  - Body: None

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": "",
      "data": {
        "user": {
          "id": 1,
          "username": "js01ca28",
          "display_name": "John Smith",
          "facility_id": "94805897432092394720",
          "profile_picture": "cdn://user/1?height=100&width=100",
          "consent": false
        }
      }
    }
    ```

    </details>

<details>
<summary>PATCH - Update the current user</summary>
Updates the current user's info, or does not change it, depending on the content.

- Require Authentication: true
- Request

  - Method `PATCH`
  - URL: /api/users/me
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "display_name": "Jane Smith",
      "profile_picture": "https://example.png",
      "consent": false
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": "",
      "data": {
        "user": {
          "id": 1,
          "username": "js01ca28",
          "display_name": "Jane Smith",
          "facility_id": "94805897432092394720",
          "profile_picture": "https://example.png",
          "consent": false
        }
      }
    }
    ```

    </details>

## Curriculum Endpoints

### /api/quiz/:id

<details>
<summary>GET - Get a quiz by id</summary>
Retrieves a quiz by its ID.

- Request

  - Method `GET`
  - URL: /api/quiz/:id
  - Body: None

- Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": " successfully retrieved a quiz by its id",
      "data": {
        "id": "12345",
        "title": "Random Quiz Title",
        "lesson_id": "67890",
        "instructions": "Complete all questions within 10 minutes.",
        "passing_score": 80,
        "feedback": "Great job! Keep practicing."
      }
    }
    ```

    </details>

### /api/test/:id

<details>
<summary>POST - Submit a quiz</summary>
submits results of quiz along with its data

- Require Authentication: true
- Request

  - Method `POST`
  - URL: /api/test/:id
  - Body:

    ```json
    {
      "userId": 1,
      "testId": 1,
      "answers": {
        "1": "a",
        "2": "b"
      },
      "timeStarted": "12:00",
      "timeFinished": "13:30",
      "totalTimeTaken": "1h 30m",
      "moreDataWeWant": "more data here"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
  - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": " successfully submitted a quiz and recieved its results",
      "data": {
        "testId": 1,
        "userId": 1,
        "score": 70,
        "totalTimeTaken": "1h"
      }
    }
    ```

    </details>

### /api/readings/:lessonId

<details>
<summary>GET - Get text content by lesson id</summary>
Returns all the readings

- Require Authentication: true
- Request

  - Method `GET`
  - URL: /api/readings/:lessonId
  - Body: none

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": " successfully retrieved text content by its lesson id",
      "data": {
        "Readings": [
          {
            "id": 1,
            "lessonId": 9495793,
            "title": "first reading",
            "order": 1,
            "content": "Lorem ipsum ...",
            "readingPt2": "Lorem ipsum ...",
            "CreatedAt": "2025-02-24 09:40:06.183551",
            "UpdatedAt": "2025-02-24 09:40:06.183551"
          }
        ]
      }
    }
    ```

- Error response: Couldn't find a reading with the specified id

  - Status Code: 404
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "text content couldn't be found with this id"
    }
    ```

    </details>

### /api/lessons/:id

<details>
<summary>GET - Get a lesson by id</summary>
Retrieves a lesson by its ID.

- Request

  - Method `GET`
  - URL: /api/lessons/:id
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
      "detail": "successfully retrieved a lesson by its id",
      "data": {
        "id": "1",
        "title": "college 101",
        "description": "helps you with college basics",
        "objectives": [
          "Understand college system",
          "learn what kind of colleges there are"
        ],
        "created_at": "2024-02-01T12:00:00Z",
        "updated_at": "2024-02-15T08:30:00Z"
      }
    }
    ```
    </details>

### /api/lessons/:id/content

<details>
<summary>GET - Get all lesson content by the lesson id </summary>
Retrieves the lessons content and formats it in order by lesson Id

- Request

  - Method `GET`
  - URL: /api/lessons/:lessonId/content
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
    "detail": "Successfully retrieved lesson content",
    "data": {
        "id": 23,
        "title": "Going to College",
        "description": "Learn about college preparation, applications, and financing",
        "objectives": [
            "Know the different types of higher education and degree types",
            "Apply for college",
            "Identify multiple strategies for financing college",
            "Understand basic vocabulary and terms around college and independent living"
        ],
        "order": 1,
        "tags": [
            "education",
            "college",
            "financing"
        ],
        "activities": {
            "1": {
                "id": 45,
                "lessonId": 23,
                "title": "Types of College",
                "content": "There are many types of colleges and ways to receive post-secondary education. There are also different types of degrees that you can get, providing various levels of expertise. Sometimes you won't know what a college offers until you ask, so it's all a matter of finding the perfect fit for you!",
                "order": 1,
                "type": "TextContent"
            },
            "2": {
                "id": 46,
                "lessonId": 23,
                "title": "Trade and Technical Schools",
                "content": "Trade and technical schools, sometimes called vocational training schools, are schools that provide education for a specific focus area without requiring general education classes. These schools typically provide certificates or associates degrees, take 1-3 years to complete, and often incorporate lots of hands-on experience.",
                "order": 2,
                "type": "TextContent"
            },
            "3": {
                "id": 47,
                "lessonId": 23,
                "title": "Community Colleges",
                "content": "Community colleges provide education for a variety of subjects, including general education and more career-specific classes. Most community colleges offer 2-year associates degrees and certificates. Some community colleges have begun offering 4-year bachelor's degrees as well.",
                "order": 3,
                "type": "TextContent"
            },
            "4": {
                "id": 23,
                "lessonId": 23,
                "title": "College Types Quiz",
                "instructions": "Select the type of college you would choose to attend for each career path.",
                "order": 4,
                "passingScore": 3,
                "feedbackConfig": {
                    "passing": "Great job! You understand the different types of colleges.",
                    "failing": "You might want to review the types of colleges section again."
                },
                "questions": [
                    {
                        "id": 34,
                        "quizId": 23,
                        "questionText": "Which type of college might you choose to attend to become a doctor?",
                        "questionType": "multiple_choice",
                        "hasCorrectAnswer": true,
                        "choices": {
                            "options": [
                                {
                                    "id": 1,
                                    "text": "Trade school",
                                    "is_correct": false
                                },
                                {
                                    "id": 2,
                                    "text": "Community college",
                                    "is_correct": false
                                },
                                {
                                    "id": 3,
                                    "text": "4-year college",
                                    "is_correct": false
                                },
                                {
                                    "id": 4,
                                    "text": "University",
                                    "is_correct": true
                                }
                            ],
                            "feedback": {
                                "correct": "If you want to become a doctor, you will need to first obtain a bachelor's degree and possibly some additional graduate school training before attending medical school, offered through a University.",
                                "incorrect": "To become a doctor requires medical school, which is offered at universities."
                            }
                        },
                        "isRequired": true,
                        "order": 1
                    },
                    {
                        "id": 35,
                        "quizId": 23,
                        "questionText": "Which type of college might you choose to attend to become a welder?",
                        "questionType": "multiple_choice",
                        "hasCorrectAnswer": true,
                        "choices": {
                            "options": [
                                {
                                    "id": 1,
                                    "text": "Trade school",
                                    "is_correct": true
                                },
                                {
                                    "id": 2,
                                    "text": "Community college",
                                    "is_correct": true
                                },
                                {
                                    "id": 3,
                                    "text": "4-year college",
                                    "is_correct": false
                                },
                                {
                                    "id": 4,
                                    "text": "University",
                                    "is_correct": false
                                }
                            ],
                            "feedback": {
                                "correct": "If you want to become a welder, you would likely attend a trade school or maybe a community college offering a certificate or associate's degree in welding.",
                                "incorrect": "Welding is a trade that is typically taught at trade schools or community colleges."
                            }
                        },
                        "isRequired": true,
                        "order": 2
                    }
                ],
                "type": "Quiz"
            },
            "5": {
                "id": 23,
                "lessonId": 23,
                "title": "Your Educational Plans",
                "instructions": "Share your thoughts about your educational goals. There are no right or wrong answers.",
                "order": 5,
                "config": {
                    "show_results": true,
                    "allow_anonymous": true
                },
                "questions": [
                    {
                        "id": 45,
                        "pollId": 23,
                        "questionText": "Which degree would you like to have?",
                        "options": [
                            {
                                "id": 1,
                                "text": "High school diploma"
                            },
                            {
                                "id": 2,
                                "text": "GED"
                            },
                            {
                                "id": 3,
                                "text": "Associate degree"
                            },
                            {
                                "id": 4,
                                "text": "Bachelor's degree"
                            },
                            {
                                "id": 5,
                                "text": "Master's degree"
                            },
                            {
                                "id": 6,
                                "text": "Professional degree"
                            },
                            {
                                "id": 7,
                                "text": "Doctoral degree"
                            }
                        ],
                        "allowMultiple": false,
                        "order": 1
                    },
                    {
                        "id": 46,
                        "pollId": 23,
                        "questionText": "Which degree do you think would be the hardest to get?",
                        "options": [
                            {
                                "id": 1,
                                "text": "High school diploma"
                            },
                            {
                                "id": 2,
                                "text": "GED"
                            },
                            {
                                "id": 3,
                                "text": "Associate degree"
                            },
                            {
                                "id": 4,
                                "text": "Bachelor's degree"
                            },
                            {
                                "id": 5,
                                "text": "Master's degree"
                            },
                            {
                                "id": 6,
                                "text": "Professional degree"
                            },
                            {
                                "id": 7,
                                "text": "Doctoral degree"
                            }
                        ],
                        "allowMultiple": false,
                        "order": 2
                    }
                ],
                "type": "Poll"
            }
        }
    }
  }
    ```
</details>

### /api/video-content/:lessonId

<details>
<summary>GET - Get video content by lesson id</summary>
Retrieves video content by its lesson Id.

- Request

  - Method `GET`
  - URL: /api/video-content/:lessonId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
      "detail": " successfully retrieved video content by its lesson id",
      "data": {
        "id": "20",
        "lesson_id": "1",
        "title": "Introduction Video",
        "order": 2,
        "description": "An introductory video on programming concepts.",
        "video_metadata": { "duration": "5 minutes", "resolution": "1080p" },
        "created_at": "2024-02-02T14:30:00Z",
        "updated_at": "2024-02-15T09:15:00Z"
      }
    }
    ```
    </details>

### /api/media-asset/:videoContentId

<details>
<summary>GET - Get media asset by id</summary>
Retrieves a media asset by its videocontent id.

- Request

  - Method `GET`
  - URL: /api/media-asset/:videoContentId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
      "detail": "",
      "data": {
        "id": "30",
        "video_content_id": "20",
        "file_path": "https://example.com/video.mp4",
        "asset_type": "video",
        "metadata": { "codec": "H.264", "bitrate": "3Mbps" },
        "content_type": "video/mp4",
        "file_size": 52428800,
        "created_at": "2024-02-02T15:00:00Z"
      }
    }
    ```
    </details>

### /api/poll/:id

<details>
<summary>GET - Get a poll by lesson id</summary>
Retrieves a poll by its lesson id.

- Request

  - Method `GET`
  - URL: /api/poll/:id
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
      "detail": "successfully retireved poll by its lesson id",
      "data": {
        "id": "40",
        "lesson_id": "1",
        "title": "what is your plan for college",
        "order": 3,
        "instructions": "pick your preferred option",
        "configuration": { "allow_multiple": false },
        "created_at": "2024-02-02T16:00:00Z",
        "updated_at": "2024-02-15T10:00:00Z"
      }
    }
    ```
    </details>

### /api/poll-question/:pollId

<details>
<summary>GET - Get all poll questions based on the poll id</summary>
get all poll questions based on the poll id

- Request

  - Method `GET`
  - URL: /api/poll-question/:pollId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
      "detail":"successfully retrieved poll question by its poll id",
      "data": {
        "id":1,
        "poll_id":93549349,
        "questionText": "what is your favorite thing about college?",
        "options": {"option1": "some options here"},
        "allow_multiple": False,
        "order":1,
        "created_at": "2024-02-02T16:00:00Z",
        "updated_at": "2024-02-15T10:00:00Z"
      },
    }
    ```
    </details>

### /api/writing-activity/:lessonId

<details>
<summary>GET - Get a writing activity by its lesson id</summary>
Retrieves a writing activity by its lesson id.

- Request

  - Method `GET`
  - URL: /api/writing-activity/:lessonId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
    ```json
    {
      "detail": " successfully retrieved writing activity by lesson id",
      "data": {
        "id": "50",
        "lesson_id": "1",
        "title": "Write a Short Paragraph about what you learned",
        "order": 4,
        "instructions": "Write your favorite part of what you've read or watched.",
        "prompts": ["take your time", "be honest when answering"],
        "created_at": "2024-02-02T17:00:00Z",
        "updated_at": "2024-02-15T11:00:00Z"
      }
    }
    ```
    </details>
