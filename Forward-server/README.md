# API Documentation

[Back to Main Docs](../README.md)

[Database Docs](./database-diagram.md)

## Introduction

#### All responses follow a consistent format

```json
{
  "detail": "Some message",
  "data": {
    "exampleObject": {
      "exampleField1": "content",
      "exampleField2": "more content"
    }
  }
}
```

#### For **Unauthorized** requests (no valid session/credentials):

- Status Code: 401 UNAUTHORIZED
- Default Response Body:

```json
{
  "detail": "Authentication credentials were not provided."
}
```

#### For **Unauthorized** reqeusts (authenticated but forbidden):

- Status Code: 403 FORBIDDEN
- Default Response Body:

```json
{
  "detail": "You do not have permission to perform this action."
}
```

# Endpoints
User Endpoints
- [/api/session](#apisession)
- [/api/users](#apiusers)
- [/api/users/me](#apiusersme)

Curriculum Endpoints
- Quiz - [/api/quiz/:id](#apiquizid)
- Quiz Submission - [/api/test/:id](#apitestid)
- Text Content - [/api/readings/:lessonId](#apireadingslessonid)
- Lesson - [/api/lessons/:id](#apilessonsid)
- Video Content - [/api/video-content/:lessonId](#apivideo-contentlessonid)
- Media Asset - [/api/media-asset/:videoContentId](#apimedia-assetvideocontentid)
- Poll - [/api/poll/:id](#apipollid)
- Poll Question - [/api/poll-question/:pollId](#apipoll-questionpollid)
- Writing Activity - [/api/writing-activity/:lessonId](#apiwriting-activitylessonid)

## User Endpoints

### /api/session

<details>
<summary>POST - Log In a User</summary>
Logs in a current user with valid credentials and returns the current user's
information.

- Require Authentication: false
- Request

  - Method: POST
  - URL: /api/session
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "credential": "js01ca28",
      "password": "secret password"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": "successfully logged in the user",
      "data": {
        "user": {
          "id": 1,
          "username": "js01ca28",
          "display_name": "John Smith",
          "facility_id": "94805897432092394720",
          "profile_picture": "cdn://user/1?height=100&width=100",
          "consent": false
        }
      }
    }
    ```

- Error Response: Invalid credentials

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Invalid credentials"
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
          "errors": {
            "credential": "Email or username is required",
            "password": "Password is required"
          }
        }
        ```

    </details>

<details>
<summary>DELETE - Log Out a User</summary>
Returns the information about the current user that is logged in.

- Require Authentication: true
- Request

  - Method: DELETE
  - URL: /api/session
  - Body: none

- Successful Response when there is a logged in user

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "detail":"Logout successful",
          "data": {}
        }
        ```

    </details>

### /api/users

<details>
<summary>POST - Sign Up a User</summary>
Creates a new user, logs them in as the current user, and returns the current
user's information.

- Require Authentication: false
- Request

  - Method: POST
  - URL: /api/users
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "firstName": "John",
      "lastName": "Smith",
      "email": "john.smith@gmail.com",
      "username": "JohnSmith",
      "password": "secret password",
      "passwordConfirm": "secret password"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": "successful user creation completed",
      "data": {
        "user": {
          "id": 1,
          "firstName": "John",
          "lastName": "Smith",
          "email": "john.smith@gmail.com",
          "username": "JohnSmith"
        }
      }
    }
    ```

- Error response: User already exists with the specified email

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "email": "User with that email already exists"
      }
    }
    ```

- Error response: User already exists with the specified username

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "username": "User with that username already exists"
      }
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
          "errors": {
            "email": "Invalid email",
            "username": "Username is required",
            "firstName": "First Name is required",
            "lastName": "Last Name is required"
          }
        }
        ```

    </details>

### /api/users/me

<details>
<summary>GET - Retrieve the current user</summary>
Confirms the current user is logged in, and returns user info.

- Require Authentication: true
- Request

  - Method: GET
  - URL: /api/users/me
  - Headers:
    - Content-Type: application/json
  - Body: None

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "detail":"",
          "data": {
            "user": {
              "id": 1,
              "username": "js01ca28",
              "display_name": "John Smith",
              "facility_id": "94805897432092394720",
              "profile_picture": "cdn://user/1?height=100&width=100",
              "consent": false
            }
          },
        }
        ```

    </details>

<details>
<summary>PATCH - Update the current user</summary>
Updates the current user's info, or does not change it, depending on the content.

- Require Authentication: true
- Request

  - Method: PATCH
  - URL: /api/users/me
  - Headers:
    - Content-Type: application/json
  - Body:

  ```json
  {
    "display_name": "Jane Smith",
    "profile_picture": "https://example.png",
    "consent": false
  }
  ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "detail":"",
          "data": {
            "user": {
              "id": 1,
              "username": "js01ca28",
              "display_name": "Jane Smith",
              "facility_id": "94805897432092394720",
              "profile_picture": "https://example.png",
              "consent": false
            }
          },
        }
        ```

    </details>

## Curriculum Endpoints

### /api/quiz/:id

<details>
<summary>GET - Get a quiz by id</summary>
Retrieves a quiz by its ID.

- Request

  - Method: GET
  - URL: /api/quiz/:id
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
  {
    "detail":" successfully retrieved a quiz by its id",
    "data": {
      "id": "12345",
      "title": "Random Quiz Title",
      "lesson_id": "67890",
      "instructions": "Complete all questions within 10 minutes.",
      "passing_score": 80,
      "feedback": "Great job! Keep practicing."
    },
  }
  `
  </details>

### /api/test/:id

<details>
<summary>POST - Submit a quiz</summary>
submits results of quiz along with its data

- Require Authentication: true
- Request

  - Method: POST
  - URL: /api/test/:id
  - Body:

    ```json
    {
      "userId": 1,
      "testId": 1,
      "answers": {
        "1": "a",
        "2": "b"
      },
      "timeStarted": "12:00",
      "timeFinished": "13:30",
      "totalTimeTaken": "1h 30m",
      "moreDataWeWant": "more data here"
    }
    ```

  - Successful Response
    _ Status Code: 200
    _ Headers:
    _ Content-Type: application/json
    _ Body:

          ```json
          {
            "detail":" successfully submitted a quiz and recieved its results",
            "data": {
              "testId":1,
              "userId":1,
              "score":70,
              "totalTimeTaken": "1h"
            },
          }
          ```

    </details>

### /api/readings/:lessonId

<details>
<summary>GET - Get text content by lesson id</summary>
Returns all the readings

- Require Authentication: true
- Request

  - Method: GET
  - URL: /api/readings/:lessonId
  - Body: none

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "detail": " successfully retrieved text content by its lesson id",
      "data": {
        "Readings": [
          {
            "id": 1,
            "lessonId": 9495793,
            "title": "first reading",
            "order": 1,
            "content": "Lorem ipsum ...",
            "readingPt2": "Lorem ipsum ...",
            "CreatedAt": "2025-02-24 09:40:06.183551",
            "UpdatedAt": "2025-02-24 09:40:06.183551"
          }
        ]
      }
    }
    ```

- Error response: Couldn't find a reading with the specified id

  - Status Code: 404
  - Headers:
    - Content-Type: application/json
  - Body:

        ```json
        {
          "message": "text content couldn't be found with this id"
        }
        ```

    </details>

### /api/lessons/:id

<details>
<summary>GET - Get a lesson by id</summary>
Retrieves a lesson by its ID.

- Request

  - Method: GET
  - URL: /api/lessons/:id
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
    {
      "detail":"successfully retrieved a lesson by its id",
      "data": {
        "id": "1",
        "title": "college 101",
        "description": "helps you with college basics",
        "objectives": ["Understand college system", "learn what kind of colleges there are"],
        "created_at": "2024-02-01T12:00:00Z",
        "updated_at": "2024-02-15T08:30:00Z"
      },
    }
    `
  </details>

### /api/video-content/:lessonId

<details>
<summary>GET - Get video content by lesson id</summary>
Retrieves video content by its lesson Id.

- Request

  - Method: GET
  - URL: /api/video-content/:lessonId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
    {
      "detail":" successfully retrieved video content by its lesson id",
        "data": {
        "id": "20",
        "lesson_id": "1",
        "title": "Introduction Video",
        "order": 2,
        "description": "An introductory video on programming concepts.",
        "video_metadata": {"duration": "5 minutes", "resolution": "1080p"},
        "created_at": "2024-02-02T14:30:00Z",
        "updated_at": "2024-02-15T09:15:00Z"
      },
    }
    `
  </details>

### /api/media-asset/:videoContentId

<details>
<summary>GET - Get media asset by id</summary>
Retrieves a media asset by its videocontent id.

- Request

  - Method: GET
  - URL: /api/media-asset/:videoContentId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
    {
      "detail":"",
      "data": {
        "id": "30",
        "video_content_id": "20",
        "file_path": "https://example.com/video.mp4",
        "asset_type": "video",
        "metadata": {"codec": "H.264", "bitrate": "3Mbps"},
        "content_type": "video/mp4",
        "file_size": 52428800,
        "created_at": "2024-02-02T15:00:00Z"
      },
    }
    `
  </details>

### /api/poll/:id

<details>
<summary>GET - Get a poll by lesson id</summary>
Retrieves a poll by its lesson id.

- Request

  - Method: GET
  - URL: /api/poll/:id
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
    {
      "detail":"successfully retireved poll by its lesson id",
      "data": {
        "id": "40",
        "lesson_id": "1",
        "title": "what is your plan for college",
        "order": 3,
        "instructions": "pick your preferred option",
        "configuration": {"allow_multiple": false},
        "created_at": "2024-02-02T16:00:00Z",
        "updated_at": "2024-02-15T10:00:00Z"
      },
    }
    `
  </details>

### /api/poll-question/:pollId

<details>
<summary>GET - Get all poll questions based on the poll id</summary>
get all poll questions based on the poll id

- Request

  - Method: GET
  - URL: /api/poll-question/:pollId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
    {
      "detail":"successfully retrieved poll question by its poll id",
      "data": {
        "id":1,
        "poll_id":93549349,
        "questionText": "what is your favorite thing about college?",
        "options": {"option1": "some options here"},
        "allow_multiple": False,
        "order":1,
        "created_at": "2024-02-02T16:00:00Z",
        "updated_at": "2024-02-15T10:00:00Z"
      },
    }
    `
  </details>

### /api/writing-activity/:lessonId

<details>
<summary>GET - Get a writing activity by its lesson id</summary>
Retrieves a writing activity by its lesson id.

- Request

  - Method: GET
  - URL: /api/writing-activity/:lessonId
  - Body: None

- Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  `json
    {
      "detail":" successfully retrieved writing activity by lesson id",
      "data": {
        "id": "50",
        "lesson_id": "1",
        "title": "Write a Short Paragraph about what you learned",
        "order": 4,
        "instructions": "Write your favorite part of what you've read or watched.",
        "prompts": ["take your time", "be honest when answering"],
        "created_at": "2024-02-02T17:00:00Z",
        "updated_at": "2024-02-15T11:00:00Z"
      },
    }
    `
  </details>
